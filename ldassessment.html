<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LD Assessment Form & Report Generator</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; font-size: 16px; }
        .container { background-color: #fff; padding: 15px; margin: 10px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; margin-top:15px; margin-bottom: 25px; font-size: 1.8em; }
        h2, h3, h4, h5 { color: #333; margin-top: 20px; }
        h4 { font-size: 1.2em; margin-bottom: 10px;}
        h5 { margin-top: 15px; margin-bottom: 8px; font-size: 1.05em; }
        fieldset { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        legend { font-weight: bold; color: #555; padding: 0 10px; font-size: 1.1em; }
        label { display: block; margin-bottom: 5px; font-weight: 500;}
        input[type="text"], input[type="number"], input[type="date"], textarea, select {
            width: 100%;
            padding: 10px;
            margin-bottom: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
        }
        textarea { min-height: 80px; }
        .checkbox-group label, .radio-group label { display: inline-block; margin-right: 15px; margin-bottom: 8px; font-weight: normal;}
        .checkbox-group input[type="checkbox"], .radio-group input[type="radio"] { margin-right: 5px; vertical-align: middle; }
        .inline-fields label { display: inline-block; margin-right: 5px; }
        .inline-fields input[type="text"], .inline-fields input[type="number"], .inline-fields select { width: auto; display: inline-block; margin-right:10px; }
        .report-output { margin-top: 30px; }
        .report-output textarea { width: 100%; height: 500px; font-family: monospace; font-size: 0.9em; }
        button#generateReportBtn {
            background-color: #007bff; color: white; padding: 12px 18px;
            border: none; border-radius: 4px; cursor: pointer; font-size: 1.1em; display: block; width: 100%; margin-top: 20px;
        }
        button#generateReportBtn:hover { background-color: #0056b3; }
        button#copyReportBtn {
            background-color: #28a745; color: white; padding: 10px 15px;
            border: none; border-radius: 4px; cursor: pointer; font-size: 1em; margin-top: 10px;
        }
        button#copyReportBtn:hover { background-color: #218838; }
        #copyMessage { margin-left: 10px; color: green; font-style: italic; display: none; }

        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .grid-item { }
        .sub-section { margin-left: 10px; border-left: 2px solid #eee; padding-left: 10px; }
        .form-row { display: flex; flex-wrap: wrap; gap: 15px; align-items: flex-start; margin-bottom:15px;}
        .form-row > div { flex: 1; min-width: 250px;}
        .form-row label { margin-bottom: 3px; }

        .fine-motor-grid {
            display: grid;
            grid-template-columns: auto repeat(4, 1fr);
            gap: 5px 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        .fine-motor-grid label { margin-bottom: 0; font-weight: normal; }
        .fine-motor-grid > span { font-weight: bold; }
        .fm-header { text-align: center;}


        .mas-function-group { border: 1px solid #eee; padding: 10px; margin-bottom: 10px; border-radius: 4px; }
        .mas-function-group div { margin-bottom: 8px; display: flex; flex-wrap: wrap; align-items: center;}
        .mas-function-group div label { display: inline-block; width: 130px; font-weight: normal; margin-bottom:0; }
        .mas-function-group div input { width: 120px; display: inline-block; padding: 6px; font-size: 0.95em; margin-bottom: 0; }

        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 0.95em;}
        th { background-color: #f2f2f2; }

        /* Range & Contracture/Deformity Styling */
        .limb-range-section .form-row { /* Reset for header only */
            display: flex;
            flex-wrap: nowrap; /* Prevent header from wrapping */
            font-weight: bold;
            background-color: #f9f9f9;
            border-bottom: 1px solid #ddd;
        }
        .limb-range-section .form-row > div {
            flex: 1;
            padding: 8px;
            text-align: center;
        }
         .limb-range-section .form-row > div:first-child { text-align: left; flex-basis: 100px; flex-grow: 0;}


        .limb-data-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
        .limb-data-row > div {
            padding: 5px;
            box-sizing: border-box;
        }
        .limb-name { flex-basis: 100px; flex-grow: 0; font-weight: bold;}
        .arom-group, .prom-group, .contracture-group { flex: 1; min-width: 150px; }
        .functional-cb-label { font-weight: normal; display: inline-flex; align-items: center; margin-left:5px;}
        .functional-cb-label input[type="checkbox"] { margin-right: 5px; width: auto;}


        @media (max-width: 768px) {
            .container { margin: 5px; padding: 10px;}
            .form-row > div { min-width: 100%; }
            .fine-motor-grid { grid-template-columns: auto repeat(2, 1fr); }
            .mas-function-group div label { width: 100%; margin-bottom: 3px;}
            .mas-function-group div input { width: 100%; }
            .checkbox-group label, .radio-group label { margin-right: 10px;}

            .limb-range-section .form-row { display: none; } /* Hide desktop header */
            .limb-data-row { flex-direction: column; align-items: stretch; }
            .limb-name { flex-basis: auto; margin-bottom: 10px; text-align: left; }
            .arom-group, .prom-group, .contracture-group { min-width: 100%; margin-bottom: 10px;}
            .arom-group input[type="text"], .prom-group input[type="text"] { width: 100%;}
            .functional-cb-label { display: block; margin-left:0; margin-top: 5px;}
        }
        @media (max-width: 480px) {
            .fine-motor-grid { grid-template-columns: 1fr; }
            .fine-motor-grid > span { grid-column: 1 / -1; text-align: left; margin-top: 10px;}
            .fm-header { font-weight: normal !important; margin-left: 15px; display:block; text-align: left !important;}
            .fine-motor-grid > .limb-header ~ label { margin-left: 15px;}
            .inline-fields input[type="text"], .inline-fields input[type="number"], .inline-fields select { width: 100%; margin-bottom: 8px;}
            .checkbox-group label, .radio-group label { display: block; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>LD Assessment Form</h1>

    <fieldset>
        <legend>Personal</legend>
        <label for="assessmentDate">Date:</label>
        <input type="date" id="assessmentDate" name="assessmentDate">
    </fieldset>

    <!-- 1. Mental State Examination -->
    <fieldset>
        <legend>1. Mental State Examination</legend>
        <div class="form-row">
            <div>
                <label>Comorbidity:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="comorbidity" value="ASD">ASD</label>
                    <label><input type="checkbox" name="comorbidity" value="ADHD">ADHD</label>
                    <label><input type="checkbox" name="comorbidity" value="Schizophrenia">Schizophrenia</label>
                    <label><input type="checkbox" name="comorbidity" value="Depression">Depression</label>
                    <label><input type="checkbox" name="comorbidity" value="BAD">BAD</label>
                    <label><input type="checkbox" name="comorbidity" value="Dementia">Dementia</label>
                </div>
                <label for="comorbidity_others">Others:</label>
                <input type="text" id="comorbidity_others" name="comorbidity_others">
            </div>
        </div>
        <div class="form-row">
            <div>
                <label>Mood:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="mood" value="Neutral">Neutral</label>
                    <label><input type="checkbox" name="mood" value="Depressed">Depressed</label>
                    <label><input type="checkbox" name="mood" value="Dysthymic">Dysthymic</label>
                    <label><input type="checkbox" name="mood" value="Euthymic">Euthymic</label>
                    <label><input type="checkbox" name="mood" value="Elated">Elated</label>
                    <label><input type="checkbox" name="mood" value="Irritable">Irritable</label>
                    <label><input type="checkbox" name="mood" value="Anxious">Anxious</label>
                </div>
                <label for="mood_others">Others:</label>
                <input type="text" id="mood_others" name="mood_others">
            </div>
            <div>
                <label>Affect:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="affect" value="Congruent">Congruent</label>
                    <label><input type="checkbox" name="affect" value="Labile">Labile</label>
                    <label><input type="checkbox" name="affect" value="Shallow">Shallow</label>
                    <label><input type="checkbox" name="affect" value="Blunted">Blunted</label>
                    <label><input type="checkbox" name="affect" value="Restricted">Restricted</label>
                </div>
            </div>
        </div>
        <div class="form-row">
            <div>
                <label>Receptive Speech:</label>
                <div class="inline-fields checkbox-group">
                    <label>Follow</label> <input type="number" id="receptive_steps" name="receptive_steps" style="width: 70px;"> <label>step</label>
                    <select id="receptive_command_type" name="receptive_command_type" style="width: auto;">
                        <option value="verbal">verbal</option>
                        <option value="gestural">gestural</option>
                    </select> <label>command</label>
                    <br>
                    <label><input type="checkbox" name="receptive_speech_options" value="Repeat verbal command">Repeat verbal command</label>
                    <label><input type="checkbox" name="receptive_speech_options" value="Not following command">Not following command</label>
                </div>
            </div>
        </div>
        <div class="form-row">
            <div>
                <label>Expressive Speech:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="expressive_speech" value="Relevant">Relevant</label>
                    <label><input type="checkbox" name="expressive_speech" value="Coherent">Coherent</label>
                    <label><input type="checkbox" name="expressive_speech" value="Spontaneous">Spontaneous</label>
                    <label><input type="checkbox" name="expressive_speech" value="Pressured">Pressured</label>
                    <label><input type="checkbox" name="expressive_speech" value="Slurred">Slurred</label>
                    <br>
                    <label><input type="checkbox" name="expressive_speech" value="Circumstantial">Circumstantial</label>
                    <label><input type="checkbox" name="expressive_speech" value="Tangential">Tangential</label>
                    <label><input type="checkbox" name="expressive_speech" value="Brief">Brief</label>
                    <label><input type="checkbox" name="expressive_speech" value="Echolalia">Echolalia</label>
                    <label><input type="checkbox" name="expressive_speech" value="No meaningful speech">No meaningful speech</label>
                    <label><input type="checkbox" name="expressive_speech" value="Mute">Mute</label>
                </div>
            </div>
        </div>
        <div class="form-row">
            <div>
                <label>Hallucination:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="hallucination" value="Auditory">Auditory</label>
                    <label><input type="checkbox" name="hallucination" value="Visual">Visual</label>
                    <label><input type="checkbox" name="hallucination" value="Olfactory">Olfactory</label>
                    <label><input type="checkbox" name="hallucination" value="Tactile">Tactile</label>
                    <label><input type="checkbox" name="hallucination" value="Gustatory">Gustatory</label>
                    <label><input type="checkbox" id="hallucination_nil" name="hallucination" value="Nil">Nil</label>
                </div>
            </div>
        </div>
        <div class="form-row">
            <div>
                <label>Abnormal Thought:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="abnormal_thought" value="Persecutory">Persecutory</label>
                    <label><input type="checkbox" name="abnormal_thought" value="Delusional">Delusional</label>
                    <label><input type="checkbox" name="abnormal_thought" value="Somatic">Somatic</label>
                    <label><input type="checkbox" name="abnormal_thought" value="Grandiose">Grandiose</label>
                    <label><input type="checkbox" name="abnormal_thought" value="Idea of reference">Idea of reference</label>
                    <br>
                    <label><input type="checkbox" name="abnormal_thought" value="Thought broadcasting">Thought broadcasting</label>
                    <label><input type="checkbox" name="abnormal_thought" value="Being control">Being control</label>
                    <label><input type="checkbox" id="abnormal_thought_nil" name="abnormal_thought" value="Nil">Nil</label>
                </div>
                <label for="abnormal_thought_others">Other, please specify:</label>
                <input type="text" id="abnormal_thought_others" name="abnormal_thought_others">
            </div>
        </div>
        <div class="form-row">
            <div>
                <label>Behaviour:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="behaviour" value="Normal">Normal</label>
                    <label><input type="checkbox" name="behaviour" value="Bizarre">Bizarre</label>
                    <label><input type="checkbox" name="behaviour" value="Self-muttering">Self-muttering</label>
                    <label><input type="checkbox" name="behaviour" value="Self-giggling">Self-giggling</label>
                    <label><input type="checkbox" name="behaviour" value="Disturbing">Disturbing</label>
                    <br>
                    <label><input type="checkbox" name="behaviour" value="Disorganized">Disorganized</label>
                    <label><input type="checkbox" name="behaviour" value="Disinhibited">Disinhibited</label>
                    <label><input type="checkbox" name="behaviour" value="Violent">Violent</label>
                    <label><input type="checkbox" name="behaviour" value="Self-stimulating">Self-stimulating</label>
                </div>
                <label for="behaviour_others">Others:</label>
                <input type="text" id="behaviour_others" name="behaviour_others">
            </div>
            <div>
                <label>Cognitive:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="cognitive" value="Oriented">Oriented</label>
                    <label><input type="checkbox" name="cognitive" value="Disoriented">Disoriented</label>
                </div>
            </div>
        </div>
        <div class="form-row">
            <div>
                <label>Risk:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="risk" value="Suicidal">Suicidal</label>
                    <label><input type="checkbox" name="risk" value="Homicidal">Homicidal</label>
                    <label><input type="checkbox" name="risk" value="Self-harm">Self-harm</label>
                    <label><input type="checkbox" name="risk" value="Self-neglect">Self-neglect</label>
                    <label><input type="checkbox" name="risk" value="Violent">Violent</label>
                    <label><input type="checkbox" name="risk" value="Environmental destruction">Environmental destruction</label>
                    <label><input type="checkbox" id="risk_nil" name="risk" value="Nil">Nil</label>
                </div>
            </div>
            <div>
                <label>Insight:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="insight" value="Full">Full</label>
                    <label><input type="checkbox" name="insight" value="Partial">Partial</label>
                    <label><input type="checkbox" name="insight" value="Limited">Limited</label>
                    <label><input type="checkbox" name="insight" value="Poor">Poor</label>
                </div>
            </div>
        </div>
        <label for="mse_others_remarks">Others/Remarks:</label>
        <textarea id="mse_others_remarks" name="mse_others_remarks"></textarea>
    </fieldset>

    <!-- 2. Physical Assessment -->
    <fieldset>
        <legend>2. Physical Assessment</legend>
        <h4>General</h4>
        <div class="form-row">
            <div>
                <label>Wound:</label>
                <div class="radio-group">
                    <label><input type="radio" name="wound_present" value="Y">Y</label>
                    <label><input type="radio" name="wound_present" value="N">N</label>
                </div>
            </div>
            <div>
                <label>Type:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="wound_type" value="Abrasion">Abrasion</label>
                    <label><input type="checkbox" name="wound_type" value="Laceration">Laceration</label>
                    <label><input type="checkbox" name="wound_type" value="Scratch">Scratch</label>
                    <label><input type="checkbox" name="wound_type" value="Bruise">Bruise</label>
                    <label><input type="checkbox" name="wound_type" value="Hematoma">Hematoma</label>
                    <label><input type="checkbox" name="wound_type" value="Blister">Blister</label>
                </div>
                <label for="wound_type_others">Others:</label>
                <input type="text" id="wound_type_others" name="wound_type_others">
            </div>
        </div>
        <div class="form-row">
            <div>
                <label for="wound_location">Location:</label>
                <input type="text" id="wound_location" name="wound_location">
            </div>
             <div>
                <label>On dressing:</label>
                 <div class="radio-group">
                    <label><input type="radio" name="wound_dressing" value="Yes">Yes</label>
                    <label><input type="radio" name="wound_dressing" value="No" checked>No</label>
                </div>
            </div>
        </div>
        <label for="general_other_observation">Other observation:</label>
        <textarea id="general_other_observation" name="general_other_observation"></textarea>

        <div class="limb-range-section">
            <h4>Range & Contracture/Deformity</h4>
            <div class="form-row"> <!-- Desktop Header -->
                <div>Limb</div>
                <div>AROM / Functional</div>
                <div>PROM</div>
                <div>Contracture/Deformity</div>
            </div>
            <!-- RUL -->
            <div class="limb-data-row">
                <div class="limb-name">RUL:</div>
                <div class="arom-group">
                    <label for="rul_arom">AROM:</label>
                    <input type="text" id="rul_arom" name="rul_arom">
                    <label class="functional-cb-label"><input type="checkbox" id="rul_arom_functional" name="rul_arom_functional"> Functional</label>
                </div>
                <div class="prom-group">
                    <label for="rul_prom">PROM:</label>
                    <input type="text" id="rul_prom" name="rul_prom">
                </div>
                <div class="contracture-group">
                    <label>Contracture/Deformity:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="rul_contracture" value="Y">Y</label>
                        <label><input type="radio" name="rul_contracture" value="N" checked>N</label>
                    </div>
                </div>
            </div>
            <!-- LUL -->
            <div class="limb-data-row">
                <div class="limb-name">LUL:</div>
                <div class="arom-group">
                    <label for="lul_arom">AROM:</label>
                    <input type="text" id="lul_arom" name="lul_arom">
                    <label class="functional-cb-label"><input type="checkbox" id="lul_arom_functional" name="lul_arom_functional"> Functional</label>
                </div>
                <div class="prom-group">
                    <label for="lul_prom">PROM:</label>
                    <input type="text" id="lul_prom" name="lul_prom">
                </div>
                <div class="contracture-group">
                    <label>Contracture/Deformity:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="lul_contracture" value="Y">Y</label>
                        <label><input type="radio" name="lul_contracture" value="N" checked>N</label>
                    </div>
                </div>
            </div>
            <!-- RLL -->
            <div class="limb-data-row">
                <div class="limb-name">RLL:</div>
                <div class="arom-group">
                    <label for="rll_arom">AROM:</label>
                    <input type="text" id="rll_arom" name="rll_arom">
                    <label class="functional-cb-label"><input type="checkbox" id="rll_arom_functional" name="rll_arom_functional"> Functional</label>
                </div>
                <div class="prom-group">
                    <label for="rll_prom">PROM:</label>
                    <input type="text" id="rll_prom" name="rll_prom">
                </div>
                <div class="contracture-group">
                    <label>Contracture/Deformity:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="rll_contracture" value="Y">Y</label>
                        <label><input type="radio" name="rll_contracture" value="N" checked>N</label>
                    </div>
                </div>
            </div>
            <!-- LLL -->
            <div class="limb-data-row">
                <div class="limb-name">LLL:</div>
                <div class="arom-group">
                    <label for="lll_arom">AROM:</label>
                    <input type="text" id="lll_arom" name="lll_arom">
                    <label class="functional-cb-label"><input type="checkbox" id="lll_arom_functional" name="lll_arom_functional"> Functional</label>
                </div>
                <div class="prom-group">
                    <label for="lll_prom">PROM:</label>
                    <input type="text" id="lll_prom" name="lll_prom">
                </div>
                <div class="contracture-group">
                    <label>Contracture/Deformity:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="lll_contracture" value="Y">Y</label>
                        <label><input type="radio" name="lll_contracture" value="N" checked>N</label>
                    </div>
                </div>
            </div>
        </div>
        <label for="pa_contracture_details">Contracture/Deformity details (e.g. specific joints):</label>
        <input type="text" id="pa_contracture_details" name="pa_contracture_details">

        <h4>Strength (MMT)</h4>
        <div class="form-row">
            <div><label for="rul_mmt">RUL MMT:</label><input type="text" id="rul_mmt" name="rul_mmt"></div>
            <div><label for="lul_mmt">LUL MMT:</label><input type="text" id="lul_mmt" name="lul_mmt"></div>
            <div><label for="rll_mmt">RLL MMT:</label><input type="text" id="rll_mmt" name="rll_mmt"></div>
            <div><label for="lll_mmt">LLL MMT:</label><input type="text" id="lll_mmt" name="lll_mmt"></div>
        </div>
        <h4>Fine Motor</h4>
        <p>Check if present (âˆš)</p>
        <div class="fine-motor-grid">
            <span></span><span class="fm-header">Grasp</span><span class="fm-header">Opposition</span><span class="fm-header">Pinch grip</span><span class="fm-header">Hand writing</span>
            <span class="limb-header">RUL:</span>
            <label><input type="checkbox" id="rul_grasp" name="rul_grasp"></label>
            <label><input type="checkbox" id="rul_opposition" name="rul_opposition"></label>
            <label><input type="checkbox" id="rul_pinch_grip" name="rul_pinch_grip"></label>
            <label><input type="checkbox" id="rul_hand_writing" name="rul_hand_writing"></label>
            <span class="limb-header">LUL:</span>
            <label><input type="checkbox" id="lul_grasp" name="lul_grasp"></label>
            <label><input type="checkbox" id="lul_opposition" name="lul_opposition"></label>
            <label><input type="checkbox" id="lul_pinch_grip" name="lul_pinch_grip"></label>
            <label><input type="checkbox" id="lul_hand_writing" name="lul_hand_writing"></label>
        </div>
    </fieldset>

    <!-- 3. Sensory Assessment -->
    <fieldset>
        <legend>3. Sensory Assessment</legend>
        <table>
            <thead><tr><th>Observation</th><th>Hypersensitivity</th><th>Hyposensitivity</th><th>Sensory Seeking</th></tr></thead>
            <tbody>
                <tr><td><strong>Auditory</strong></td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="auditory_hyper" value="Covering ears">Covering ears to block out sounds</label><br>
                        <label><input type="checkbox" name="auditory_hyper" value="Overwhelmed by loud/unexpected noises">Overwhelmed by loud or unexpected noises</label>
                    </td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="auditory_hypo" value="Not responding to sounds">Not responding to sounds</label><br>
                        <label><input type="checkbox" name="auditory_hypo" value="Unaware of salient auditory stimuli">Unaware of auditory stimuli that are salient to others</label>
                    </td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="auditory_seeking" value="Enjoying loud noises">Enjoying loud noises and making them</label><br>
                        <label><input type="checkbox" name="auditory_seeking" value="Thriving in loud environments">Thriving in loud environments</label>
                    </td></tr>
                <tr><td><strong>Visual</strong></td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="visual_hyper" value="Discomfort with bright lights/patterns">Discomfort with bright lights or certain visual patterns</label><br>
                        <label><input type="checkbox" name="visual_hyper" value="Avoiding eye contact/shielding eyes">Avoiding eye contact or shielding eyes</label>
                    </td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="visual_hypo" value="Lack of response to visual stimuli">Lack of response to visual stimuli</label><br>
                        <label><input type="checkbox" name="visual_hypo" value="Not noticing objects">Not noticing objects in their environment</label>
                    </td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="visual_seeking" value="Staring at shiny/colourful objects">Staring at shiny or colourful objects</label><br>
                        <label><input type="checkbox" name="visual_seeking" value="Waving/placing objects close to eyes">Waving or placing objects very close to their eyes</label>
                    </td></tr>
                <tr><td><strong>Oral</strong></td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="oral_hyper" value="Aversion to certain food textures/tastes">Aversion to certain food textures or tastes</label><br>
                        <label><input type="checkbox" name="oral_hyper" value="Gagging/vomiting to certain foods">Gagging or vomiting in response to certain foods</label>
                    </td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="oral_hypo" value="Seeking out intense flavours">Seeking out intense flavours</label><br>
                        <label><input type="checkbox" name="oral_hypo" value="Not noticing food temperature">Not noticing food temperature</label>
                    </td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="oral_seeking" value="Chewing on non-food items">Chewing on non-food items</label><br>
                        <label><input type="checkbox" name="oral_seeking" value="Preferring strong-tasting foods">Preferring strong-tasting foods</label>
                    </td></tr>
                <tr><td><strong>Tactile</strong></td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="tactile_hyper" value="Discomfort with certain textures">Discomfort with certain textures</label><br>
                        <label><input type="checkbox" name="tactile_hyper" value="Avoiding specific clothing/touch">Avoiding specific clothing or refusing to touch certain materials</label>
                    </td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="tactile_hypo" value="Seeking out intense tactile experiences">Seeking out intense tactile experiences</label><br>
                        <label><input type="checkbox" name="tactile_hypo" value="Not noticing pain">Not noticing pain</label>
                    </td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="tactile_seeking" value="Enjoying being touched/massaged">Enjoying being touched, massaged, tickled, and hugged</label><br>
                        <label><input type="checkbox" name="tactile_seeking" value="Walking barefoot everywhere">Walking barefoot everywhere</label>
                    </td></tr>
                <tr><td><strong>Proprioception</strong></td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="proprioception_hyper" value="Discomfort with certain movements/positions">Discomfort with certain movements or positions</label>
                    </td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="proprioception_hypo" value="Poor body awareness">Poor body awareness</label><br>
                        <label><input type="checkbox" name="proprioception_hypo" value="Clumsiness in movement">Clumsiness in movement</label>
                    </td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="proprioception_seeking" value="Pushing others or objects">Pushing others or objects</label><br>
                        <label><input type="checkbox" name="proprioception_seeking" value="Crashing, falling, running">Crashing, falling, running</label>
                    </td></tr>
                <tr><td><strong>Vestibular</strong></td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="vestibular_hyper" value="Hypersensitivity to movement">Hypersensitivity to movement</label><br>
                        <label><input type="checkbox" name="vestibular_hyper" value="Poor motor coordination/balance">Poor motor coordination and balance</label>
                    </td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="vestibular_hypo" value="Seeking out intense movement experiences">Seeking out intense movement experiences</label><br>
                        <label><input type="checkbox" name="vestibular_hypo" value="Delayed developmental milestones (sitting/walking)">Delayed developmental milestones like sitting/walking</label>
                    </td>
                    <td class="checkbox-group">
                        <label><input type="checkbox" name="vestibular_seeking" value="Rocking back and forth">Rocking back and forth</label><br>
                        <label><input type="checkbox" name="vestibular_seeking" value="Swinging their legs">Swinging their legs</label>
                    </td></tr>
            </tbody>
        </table>
        <label for="sensory_assessment_others">Others (Examples/Observations for report):</label>
        <textarea id="sensory_assessment_others" name="sensory_assessment_others"></textarea>
        <h4>Sensory Profile</h4>
        <label for="sensory_profile_informant">Informant:</label>
        <input type="text" id="sensory_profile_informant" name="sensory_profile_informant">
        <div class="grid-container">
            <div class="grid-item">
                <label>Low Registration: <input type="number" id="sp_low_reg_score" name="sp_low_reg_score" style="width: 70px;"> /75</label>
                <div class="checkbox-group">
                    Less Than Others: <label><input type="checkbox" name="sp_low_reg_interpretation" value="Definite Difference (Less)">Definite Difference</label> <label><input type="checkbox" name="sp_low_reg_interpretation" value="Probable Difference (Less)">Probable Difference</label><br>
                    <label><input type="checkbox" name="sp_low_reg_interpretation" value="Typical Performance">Typical Performance</label><br>
                    More Than Others: <label><input type="checkbox" name="sp_low_reg_interpretation" value="Definite Difference (More)">Definite Difference</label> <label><input type="checkbox" name="sp_low_reg_interpretation" value="Probable Difference (More)">Probable Difference</label>
                </div>
            </div>
            <div class="grid-item">
                <label>Sensation Seeking: <input type="number" id="sp_sensation_seeking_score" name="sp_sensation_seeking_score" style="width: 70px;"> /75</label>
                <div class="checkbox-group">
                    Less Than Others: <label><input type="checkbox" name="sp_sensation_seeking_interpretation" value="Definite Difference (Less)">Definite Difference</label> <label><input type="checkbox" name="sp_sensation_seeking_interpretation" value="Probable Difference (Less)">Probable Difference</label><br>
                    <label><input type="checkbox" name="sp_sensation_seeking_interpretation" value="Typical Performance">Typical Performance</label><br>
                    More Than Others: <label><input type="checkbox" name="sp_sensation_seeking_interpretation" value="Definite Difference (More)">Definite Difference</label> <label><input type="checkbox" name="sp_sensation_seeking_interpretation" value="Probable Difference (More)">Probable Difference</label>
                </div>
            </div>
            <div class="grid-item">
                <label>Sensory Sensitive: <input type="number" id="sp_sensory_sensitive_score" name="sp_sensory_sensitive_score" style="width: 70px;"> /75</label>
                <div class="checkbox-group">
                    Less Than Others: <label><input type="checkbox" name="sp_sensory_sensitive_interpretation" value="Definite Difference (Less)">Definite Difference</label> <label><input type="checkbox" name="sp_sensory_sensitive_interpretation" value="Probable Difference (Less)">Probable Difference</label><br>
                    <label><input type="checkbox" name="sp_sensory_sensitive_interpretation" value="Typical Performance">Typical Performance</label><br>
                    More Than Others: <label><input type="checkbox" name="sp_sensory_sensitive_interpretation" value="Definite Difference (More)">Definite Difference</label> <label><input type="checkbox" name="sp_sensory_sensitive_interpretation" value="Probable Difference (More)">Probable Difference</label>
                </div>
            </div>
            <div class="grid-item">
                <label>Sensory Avoidance: <input type="number" id="sp_sensory_avoidance_score" name="sp_sensory_avoidance_score" style="width: 70px;"> /75</label>
                <div class="checkbox-group">
                    Less Than Others: <label><input type="checkbox" name="sp_sensory_avoidance_interpretation" value="Definite Difference (Less)">Definite Difference</label> <label><input type="checkbox" name="sp_sensory_avoidance_interpretation" value="Probable Difference (Less)">Probable Difference</label><br>
                    <label><input type="checkbox" name="sp_sensory_avoidance_interpretation" value="Typical Performance">Typical Performance</label><br>
                    More Than Others: <label><input type="checkbox" name="sp_sensory_avoidance_interpretation" value="Definite Difference (More)">Definite Difference</label> <label><input type="checkbox" name="sp_sensory_avoidance_interpretation" value="Probable Difference (More)">Probable Difference</label>
                </div>
            </div>
        </div>
    </fieldset>

    <!-- 4. Behavioural Assessment -->
    <fieldset>
        <legend>4. Behavioural Assessment</legend>
        <h4>Motivational Assessment Scale (MAS)</h4>
        <label for="mas_target_behaviour_overall">Target Behaviour (Overall for MAS):</label>
        <input type="text" id="mas_target_behaviour_overall" name="mas_target_behaviour_overall">

        <div class="mas-function-group">
            <h5>Sensory</h5>
            <div><label for="mas_sensory_total">Total Score:</label> <input type="number" id="mas_sensory_total" class="mas-total-score"></div>
            <div><label for="mas_sensory_average">Average Score:</label> <input type="text" id="mas_sensory_average" readonly></div>
            <div><label for="mas_sensory_ranking">Relative Ranking:</label> <input type="text" id="mas_sensory_ranking" readonly></div>
        </div>
        <div class="mas-function-group">
            <h5>Escape</h5>
            <div><label for="mas_escape_total">Total Score:</label> <input type="number" id="mas_escape_total" class="mas-total-score"></div>
            <div><label for="mas_escape_average">Average Score:</label> <input type="text" id="mas_escape_average" readonly></div>
            <div><label for="mas_escape_ranking">Relative Ranking:</label> <input type="text" id="mas_escape_ranking" readonly></div>
        </div>
        <div class="mas-function-group">
            <h5>Attention</h5>
            <div><label for="mas_attention_total">Total Score:</label> <input type="number" id="mas_attention_total" class="mas-total-score"></div>
            <div><label for="mas_attention_average">Average Score:</label> <input type="text" id="mas_attention_average" readonly></div>
            <div><label for="mas_attention_ranking">Relative Ranking:</label> <input type="text" id="mas_attention_ranking" readonly></div>
        </div>
        <div class="mas-function-group">
            <h5>Tangible</h5>
            <div><label for="mas_tangible_total">Total Score:</label> <input type="number" id="mas_tangible_total" class="mas-total-score"></div>
            <div><label for="mas_tangible_average">Average Score:</label> <input type="text" id="mas_tangible_average" readonly></div>
            <div><label for="mas_tangible_ranking">Relative Ranking:</label> <input type="text" id="mas_tangible_ranking" readonly></div>
        </div>

        <h4>Challenging Behaviour Interview (CBI)</h4>
        <label for="cbi_target_behaviour">Target Behaviour (Patient's major challenging behaviour):</label>
        <input type="text" id="cbi_target_behaviour" name="cbi_target_behaviour">
        <label for="cbi_total_score">Total Score: <input type="text" id="cbi_total_score" name="cbi_total_score" style="width: 70px;"> /55</label>
    </fieldset>

    <!-- 5. Environmental Assessment -->
    <fieldset>
        <legend>5. Environmental Assessment</legend>
        <h4>Background</h4>
        <label>Lives with:</label>
        <div class="checkbox-group">
            <label><input type="checkbox" name="lives_with" value="Alone">Alone</label>
            <label><input type="checkbox" name="lives_with" value="Parents">Parents</label>
            <label><input type="checkbox" name="lives_with" value="Private Hostel">Private Hostel</label>
            <label><input type="checkbox" name="lives_with" value="HWH">HWH</label>
            <label><input type="checkbox" name="lives_with" value="HMMH">HMMH</label>
            <label><input type="checkbox" name="lives_with" value="HSMH">HSMH</label>
            <label><input type="checkbox" name="lives_with" value="Boarding School">Boarding School</label>
        </div>
        <label for="lives_with_others">Others:</label>
        <input type="text" id="lives_with_others" name="lives_with_others">

        <h4>Home visit / Hostel Environment</h4>
        <div id="home_visit_env_content">
            <div class="form-row">
                <div>
                    <label>Lighting:</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="env_lighting" value="Adequate">Adequate</label>
                        <label><input type="checkbox" name="env_lighting" value="Inadequate">Inadequate</label>
                        <label><input type="checkbox" name="env_lighting" value="Over-lighting">Over-lighting</label>
                    </div>
                </div>
                <div>
                    <label>Noise:</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="env_noise" value="Quiet">Quiet</label>
                        <label><input type="checkbox" name="env_noise" value="Moderate noise">Moderate noise</label>
                        <label><input type="checkbox" name="env_noise" value="High noise">High noise</label>
                        <label><input type="checkbox" name="env_noise" value="Quiet zone/ Pad room available">Quiet zone/ Pad room available</label>
                        <label><input type="checkbox" name="env_noise_not_available" value="Quiet zone/ Pad room was not available">Quiet zone/ Pad room NOT available</label>
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div>
                    <label>Safety Hazard:</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="env_safety_hazard" value="Fall">Fall</label>
                        <label><input type="checkbox" name="env_safety_hazard" value="Access to sharps">Access to sharps</label>
                        <label><input type="checkbox" name="env_safety_hazard" value="Access to poison">Access to poison</label>
                        <label><input type="checkbox" name="env_safety_hazard_not_presented" value="Not presented">Not presented</label>
                    </div>
                    <label for="env_safety_hazard_others">Others / Describe if +ve:</label>
                    <input type="text" id="env_safety_hazard_others" name="env_safety_hazard_others">
                </div>
                <div>
                    <label>Social stimulation:</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="env_social_stimulation" value="Provocation from co-resident">Provocation from co-resident</label>
                        <label><input type="checkbox" name="env_social_stimulation" value="Social isolation">Social isolation</label>
                    </div>
                    <label for="env_social_stimulation_others">Others (e.g. social over-stimulation):</label>
                    <input type="text" id="env_social_stimulation_others" name="env_social_stimulation_others">
                </div>
            </div>
            <div class="form-row">
                <div>
                    <label>Change of environment:</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="env_change" value="Change of physical environment">Change of physical environment</label>
                        <label><input type="checkbox" name="env_change" value="Routine changes">Routine changes</label>
                        <label><input type="checkbox" name="env_change" value="Carer changes">Carer changes</label>
                    </div>
                    <label for="env_change_others">Others / Specify:</label>
                    <input type="text" id="env_change_others" name="env_change_others">
                </div>
            </div>

            <h5>Staff / Parent Interaction</h5>
             <div class="form-row">
                <div>
                    <label>Staff handling:</label>
                     <div class="checkbox-group">
                        <label><input type="checkbox" name="staff_handling_type" value="Inconsistent handling">Inconsistent handling</label>
                        <label><input type="checkbox" name="staff_handling_type" value="Firm handling">Firm handling</label>
                    </div>
                    <label for="staff_handling_others">Others:</label>
                    <input type="text" id="staff_handling_others" name="staff_handling_others">
                </div>
                <div>
                    <label for="staff_expectation_behaviour">Staff's expectation on behaviour:</label>
                    <input type="text" id="staff_expectation_behaviour" name="staff_expectation_behaviour">
                </div>
            </div>
            <label for="staff_parents_concern">Hostel staff/ parents concerned about patient's behaviour of (most concerned behaviour):</label>
            <input type="text" id="staff_parents_concern" name="staff_parents_concern">
            <label for="staff_parents_response">In response to patient's challenging behaviours, hostel staff/ parents would (staff measures) with satisfactory/ suboptimal effect:</label>
            <textarea id="staff_parents_response" name="staff_parents_response"></textarea>

            <h5>Restrain Policy (if applicable)</h5>
            <label>Restrain:</label>
            <div class="radio-group">
                <label><input type="radio" name="restrain_policy" value="Yes">Yes</label>
                <label><input type="radio" name="restrain_policy" value="No">No</label>
            </div>
            <div class="sub-section" id="restrain_details_section" style="display:none;">
                <label>Restrain period:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="restrain_period" value="Daytime">Daytime</label>
                    <label><input type="checkbox" name="restrain_period" value="Day training">Day training</label>
                    <label><input type="checkbox" name="restrain_period" value="Nighttime">Nighttime</label>
                    <label><input type="checkbox" name="restrain_period" value="Sleep">Sleep</label>
                </div>
                <label for="restrain_period_others">Others:</label>
                <input type="text" id="restrain_period_others" name="restrain_period_others">
                <label for="restrain_situation">Situation of restrain:</label>
                <textarea id="restrain_situation" name="restrain_situation"></textarea>
                <label>Body part on restrain:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="restrain_body_part" value="Waist">Waist</label>
                    <label><input type="checkbox" name="restrain_body_part" value="Wrist">Wrist</label>
                    <label><input type="checkbox" name="restrain_body_part" value="Hand">Hand</label>
                    <label><input type="checkbox" name="restrain_body_part" value="Ankle">Ankle</label>
                    <label><input type="checkbox" name="restrain_body_part" value="Upper body">Upper body</label>
                    <label><input type="checkbox" name="restrain_body_part" value="Lower body">Lower body</label>
                </div>
                <label for="restrain_body_part_others">Others:</label>
                <input type="text" id="restrain_body_part_others" name="restrain_body_part_others">
                <label>Restrainer type:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="restrainer_type" value="Magnetic belt">Magnetic belt</label>
                    <label><input type="checkbox" name="restrainer_type" value="Fabric belt">Fabric belt</label>
                    <label><input type="checkbox" name="restrainer_type" value="Special garment (Upper/Lower)">Special garment (Upper/Lower)</label>
                    <label><input type="checkbox" name="restrainer_type" value="Boxing gloves">Boxing gloves</label>
                    <label><input type="checkbox" name="restrainer_type" value="Chair-table">Chair-table</label>
                </div>
                <label for="restrainer_type_others">Others:</label>
                <input type="text" id="restrainer_type_others" name="restrainer_type_others">
                <label for="restrain_other_info">Other information:</label>
                <textarea id="restrain_other_info" name="restrain_other_info"></textarea>
            </div>

            <h5>Family Involvement</h5>
            <label for="parent_visit_frequency">Parents would/ would not provide visit to hostel (frequency):</label>
            <input type="text" id="parent_visit_frequency" name="parent_visit_frequency">
            <label for="patient_behaviour_visit">Before/ after the visit, patient remained calm and settled/ showed agitation/ showed challenging behaviour of (problem behaviour):</label>
            <input type="text" id="patient_behaviour_visit" name="patient_behaviour_visit">
            <label>Parenting style:</label>
            <div class="checkbox-group">
                <label><input type="checkbox" name="parenting_style" value="Authoritative">Authoritative</label>
                <label><input type="checkbox" name="parenting_style" value="Authoritarian">Authoritarian</label>
                <label><input type="checkbox" name="parenting_style" value="Permissive">Permissive</label>
                <label><input type="checkbox" name="parenting_style" value="Uninvolved">Uninvolved</label>
            </div>
            <label for="parenting_style_other_info">Other information:</label>
            <textarea id="parenting_style_other_info" name="parenting_style_other_info"></textarea>
        </div>
        <label for="env_others_layout">Others (e.g. Layout):</label>
        <textarea id="env_others_layout" name="env_others_layout"></textarea>
    </fieldset>

    <!-- Occupation -->
    <fieldset>
        <legend>Occupation</legend>
        <textarea id="occupation_details" name="occupation_details"></textarea>
    </fieldset>

    <!-- 6. Independent Function Assessment -->
    <fieldset>
        <legend>6. Independent Function Assessment</legend>
        <h4>BADL (MBI)</h4>
        <div class="grid-container">
            <div><label>Feeding: <input type="number" name="mbi_feeding" class="mbi-score-field"> /10</label></div>
            <div><label>Grooming: <input type="number" name="mbi_grooming" class="mbi-score-field"> /5</label></div>
            <div><label>Dressing: <input type="number" name="mbi_dressing" class="mbi-score-field"> /10</label></div>
            <div><label>Toileting: <input type="number" name="mbi_toileting" class="mbi-score-field"> /10</label></div>
            <div><label>Bathing: <input type="number" name="mbi_bathing" class="mbi-score-field"> /5</label></div>
            <div><label>Transfer: <input type="number" name="mbi_transfer" class="mbi-score-field"> /15</label></div>
            <div><label>Bladder: <input type="number" name="mbi_bladder" class="mbi-score-field"> /10</label></div>
            <div><label>Bowel: <input type="number" name="mbi_bowel" class="mbi-score-field"> /10</label></div>
            <div><label>Ambulation: <input type="number" name="mbi_ambulation" class="mbi-score-field"> /15</label></div>
            <div><label>Stairs: <input type="number" name="mbi_stairs" class="mbi-score-field"> /10</label></div>
        </div>
        <label>Total MBI Score: <input type="text" id="mbi_total_score_display" name="mbi_total_score_display" readonly> /100</label>

        <p><em>Qualitative BADL Levels:</em></p>
        <div class="form-row">
            <div>
                <label for="badl_feeding_level">Feeding:</label>
                <select id="badl_feeding_level" name="badl_feeding_level">
                    <option value="">Select Level</option><option value="Independent">Independent</option><option value="Supervision">Supervision</option><option value="Mild Assist">Mild Assist</option><option value="Mod Assist">Mod Assist</option><option value="Max Assist">Max Assist</option><option value="Dependent">Dependent</option>
                </select>
            </div>
            <div>
                <label for="badl_grooming_level">Grooming:</label>
                <select id="badl_grooming_level" name="badl_grooming_level">
                    <option value="">Select Level</option><option value="Independent">Independent</option><option value="Supervision">Supervision</option><option value="Mild Assist">Mild Assist</option><option value="Mod Assist">Mod Assist</option><option value="Max Assist">Max Assist</option><option value="Dependent">Dependent</option>
                </select>
            </div>
        </div>
        <div class="form-row">
            <div>
                <label for="badl_dressing_level">Dressing:</label>
                <select id="badl_dressing_level" name="badl_dressing_level">
                    <option value="">Select Level</option><option value="Independent">Independent</option><option value="Supervision">Supervision</option><option value="Mild Assist">Mild Assist</option><option value="Mod Assist">Mod Assist</option><option value="Max Assist">Max Assist</option><option value="Dependent">Dependent</option>
                </select>
            </div>
            <div>
                <label for="badl_toileting_level">Toileting:</label>
                <select id="badl_toileting_level" name="badl_toileting_level">
                    <option value="">Select Level</option><option value="Independent">Independent</option><option value="Supervision">Supervision</option><option value="Mild Assist">Mild Assist</option><option value="Mod Assist">Mod Assist</option><option value="Max Assist">Max Assist</option><option value="Dependent">Dependent</option>
                </select>
            </div>
        </div>
        <div class="form-row">
            <div>
                <label for="badl_bathing_level">Bathing:</label>
                <select id="badl_bathing_level" name="badl_bathing_level">
                    <option value="">Select Level</option><option value="Independent">Independent</option><option value="Supervision">Supervision</option><option value="Mild Assist">Mild Assist</option><option value="Mod Assist">Mod Assist</option><option value="Max Assist">Max Assist</option><option value="Dependent">Dependent</option>
                </select>
            </div>
             <div> <!-- Placeholder for alignment --> </div>
        </div>
        <label for="mbi_remarks">Remarks:</label>
        <textarea id="mbi_remarks" name="mbi_remarks"></textarea>

        <h4>IADL (SIB-R Short form)</h4>
        <div class="form-row">
            <div>
                <label>Patient's Chronological Age:</label>
                <input type="number" name="sibr_chron_age_year" placeholder="Year" style="width: 80px;"> year(s)
                <input type="number" name="sibr_chron_age_month" placeholder="Month" style="width: 80px;"> month(s)
            </div>
            <div>
                <label>Broad Independence Age Equivalent:</label>
                <input type="number" name="sibr_indep_age_year" placeholder="Year" style="width: 80px;"> year(s)
                <input type="number" name="sibr_indep_age_month" placeholder="Month" style="width: 80px;"> month(s)
            </div>
        </div>
        <label>Maladaptive Behaviour Severity Level:</label>
        <div class="checkbox-group">
            <label><input type="radio" name="sibr_maladaptive_level" value="Normal">Normal</label>
            <label><input type="radio" name="sibr_maladaptive_level" value="Marginally serious">Marginally serious</label>
            <label><input type="radio" name="sibr_maladaptive_level" value="Moderately serious">Moderately serious</label>
            <label><input type="radio" name="sibr_maladaptive_level" value="Serious">Serious</label>
            <label><input type="radio" name="sibr_maladaptive_level" value="Very serious">Very serious</label>
        </div>
        <label>Support Score: <input type="text" name="sibr_support_score"> /100</label>
        <label>Support Level:</label>
        <div class="checkbox-group">
            <label><input type="radio" name="sibr_support_level" value="Pervasive (1-24)">Pervasive (1-24)</label>
            <label><input type="radio" name="sibr_support_level" value="Extensive (25-39)">Extensive (25-39)</label>
            <label><input type="radio" name="sibr_support_level" value="Frequent (40-54)">Frequent (40-54)</label>
            <label><input type="radio" name="sibr_support_level" value="Limited (55-69)">Limited (55-69)</label>
            <label><input type="radio" name="sibr_support_level" value="Intermittent (70-84)">Intermittent (70-84)</label>
            <label><input type="radio" name="sibr_support_level" value="Infrequent or No support (85-100)">Infrequent or No support (85-100)</label>
        </div>
        <label for="sibr_remarks">Remarks:</label>
        <textarea id="sibr_remarks" name="sibr_remarks"></textarea>
    </fieldset>

    <!-- 7. Work Assessment -->
    <fieldset>
        <legend>7. Work Assessment</legend>
        <h4>Premorbid</h4>
        <div class="checkbox-group">
            <label><input type="checkbox" name="premorbid_status" value="Unemployed">Unemployed</label>
            <label><input type="checkbox" name="premorbid_status" value="Student">Student</label>
            <label><input type="checkbox" name="premorbid_status" value="DSC attendant">DSC attendant</label>
            <label><input type="checkbox" name="premorbid_status" value="DAC attendant">DAC attendant</label>
            <label><input type="checkbox" name="premorbid_status" value="SWS attendant">SWS attendant</label>
            <label><input type="checkbox" name="premorbid_status" value="SE attendant">SE attendant</label>
        </div>
        <div class="form-row">
            <div style="display: flex; align-items: center; width: 100%;">
                <label style="margin-right: 5px; width: auto;"><input type="checkbox" id="premorbid_oe_job_status_cb" name="premorbid_status" value="OE"> OE (job):</label>
                <input type="text" id="premorbid_oe_job_details" name="premorbid_oe_job_details" placeholder="Specify OE job" style="flex-grow: 1; margin-bottom: 0;">
            </div>
        </div>
        <label for="premorbid_main_work_task">Main work task:</label>
        <textarea id="premorbid_main_work_task" name="premorbid_main_work_task"></textarea>

        <h4>BWAP-2</h4>
        <div class="grid-container">
            <div>
                <label>Work Habits/ Attitudes Percentile:</label> <input type="text" id="bwap_wha_percentile" name="bwap_wha_percentile">
                <label>Working Placement:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="bwap_wha_placement" value="Day Care">Day Care</label>
                    <label><input type="checkbox" name="bwap_wha_placement" value="Work Activity">Work Activity</label>
                    <label><input type="checkbox" name="bwap_wha_placement" value="Low Sheltered">Low Sheltered</label>
                    <label><input type="checkbox" name="bwap_wha_placement" value="High Sheltered">High Sheltered</label>
                    <label><input type="checkbox" name="bwap_wha_placement" value="Transitional Work">Transitional Work</label>
                    <label><input type="checkbox" name="bwap_wha_placement" value="Competitive Work">Competitive Work</label>
                </div>
            </div>
            <div>
                <label>Interpersonal Relations Percentile:</label> <input type="text" id="bwap_ir_percentile" name="bwap_ir_percentile">
                <label>Working Placement:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="bwap_ir_placement" value="Day Care">Day Care</label>
                    <label><input type="checkbox" name="bwap_ir_placement" value="Work Activity">Work Activity</label>
                    <label><input type="checkbox" name="bwap_ir_placement" value="Low Sheltered">Low Sheltered</label>
                    <label><input type="checkbox" name="bwap_ir_placement" value="High Sheltered">High Sheltered</label>
                    <label><input type="checkbox" name="bwap_ir_placement" value="Transitional Work">Transitional Work</label>
                    <label><input type="checkbox" name="bwap_ir_placement" value="Competitive Work">Competitive Work</label>
                </div>
            </div>
            <div>
                <label>Cognitive Skills Percentile:</label> <input type="text" id="bwap_cs_percentile" name="bwap_cs_percentile">
                <label>Working Placement:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="bwap_cs_placement" value="Day Care">Day Care</label>
                    <label><input type="checkbox" name="bwap_cs_placement" value="Work Activity">Work Activity</label>
                    <label><input type="checkbox" name="bwap_cs_placement" value="Low Sheltered">Low Sheltered</label>
                    <label><input type="checkbox" name="bwap_cs_placement" value="High Sheltered">High Sheltered</label>
                    <label><input type="checkbox" name="bwap_cs_placement" value="Transitional Work">Transitional Work</label>
                    <label><input type="checkbox" name="bwap_cs_placement" value="Competitive Work">Competitive Work</label>
                </div>
            </div>
            <div>
                <label>Work Performance Skills Percentile:</label> <input type="text" id="bwap_wps_percentile" name="bwap_wps_percentile">
                <label>Working Placement:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="bwap_wps_placement" value="Day Care">Day Care</label>
                    <label><input type="checkbox" name="bwap_wps_placement" value="Work Activity">Work Activity</label>
                    <label><input type="checkbox" name="bwap_wps_placement" value="Low Sheltered">Low Sheltered</label>
                    <label><input type="checkbox" name="bwap_wps_placement" value="High Sheltered">High Sheltered</label>
                    <label><input type="checkbox" name="bwap_wps_placement" value="Transitional Work">Transitional Work</label>
                    <label><input type="checkbox" name="bwap_wps_placement" value="Competitive Work">Competitive Work</label>
                </div>
            </div>
            <div>
                <label>Broad Work Adjustment Percentile:</label> <input type="text" id="bwap_bwa_percentile" name="bwap_bwa_percentile">
                <label>Working Placement:</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="bwap_bwa_placement" value="Day Care">Day Care</label>
                    <label><input type="checkbox" name="bwap_bwa_placement" value="Work Activity">Work Activity</label>
                    <label><input type="checkbox" name="bwap_bwa_placement" value="Low Sheltered">Low Sheltered</label>
                    <label><input type="checkbox" name="bwap_bwa_placement" value="High Sheltered">High Sheltered</label>
                    <label><input type="checkbox" name="bwap_bwa_placement" value="Transitional Work">Transitional Work</label>
                    <label><input type="checkbox" name="bwap_bwa_placement" value="Competitive Work">Competitive Work</label>
                </div>
            </div>
        </div>
        <label for="bwap_remarks">Remarks:</label>
        <textarea id="bwap_remarks" name="bwap_remarks"></textarea>
    </fieldset>

    <fieldset>
        <legend>OT Plan Options</legend>
        <div class="checkbox-group">
            <label><input type="checkbox" id="otp_mental_state" name="otp_item" value="Mental state observation">Mental state observation</label><br>
            <label><input type="checkbox" id="otp_hand_function" name="otp_item" value="Hand function training">Hand function training</label><br>
            <label><input type="checkbox" id="otp_sensory_intervention" name="otp_item" value="Sensory-based intervention">Sensory-based intervention</label><br>
            <label><input type="checkbox" id="otp_behavioural_management" name="otp_item" value="Behavioural management">Behavioural management</label><br>
            <label><input type="checkbox" id="otp_home_visit" name="otp_item" value="Home / Hostel visit">Home / Hostel visit on (date)</label><br>
            <label><input type="checkbox" id="otp_adl_iadl_training" name="otp_item" value="ADL / IADL functional training">ADL / IADL functional training</label><br>
            <label><input type="checkbox" id="otp_sws_dac_training" name="otp_item" value="SWS / DAC simulation training">SWS / DAC simulation training</label><br>
            <label><input type="checkbox" id="otp_aids_garment" name="otp_item" value="Aids/ Special garment: (name) prescription">Aids/ Special garment: (name) prescription</label>
        </div>
        <label for="ot_plan_custom">Custom OT Plan items (add each on a new line):</label>
        <textarea id="ot_plan_custom" name="ot_plan_custom"></textarea>
    </fieldset>

    <button type="button" id="generateReportBtn" onclick="generateReport()">Generate Report</button>

    <div class="report-output">
        <h3>Generated Report</h3>
        <textarea id="reportTextArea" readonly></textarea>
        <button type="button" id="copyReportBtn" onclick="copyReport()">Copy Report</button>
        <span id="copyMessage"></span>
    </div>
</div>

<script>
    // Restrain policy visibility
    document.querySelectorAll('input[name="restrain_policy"]').forEach(radio => {
        radio.addEventListener('change', function() {
            document.getElementById('restrain_details_section').style.display = this.value === 'Yes' ? 'block' : 'none';
        });
    });

    // MBI Total Score Calculation
    const mbiScoreFields = document.querySelectorAll('.mbi-score-field');
    mbiScoreFields.forEach(field => {
        field.addEventListener('input', updateMbiTotal);
    });

    function updateMbiTotal() {
        let total = 0;
        let anyInput = false;
        mbiScoreFields.forEach(field => {
            if (field.value.trim() !== '') {
                anyInput = true;
                const val = parseInt(field.value) || 0;
                total += val;
            }
        });
        document.getElementById('mbi_total_score_display').value = anyInput ? total : '';
    }
    updateMbiTotal();

    // MAS Average Score and Ranking Calculation
    const masTotalScoreInputs = document.querySelectorAll('.mas-total-score');
    masTotalScoreInputs.forEach(input => {
        input.addEventListener('input', function() {
            const functionKey = this.id.split('_')[1];
            const total = parseFloat(this.value);
            const averageField = document.getElementById(`mas_${functionKey}_average`);
            if (averageField) {
                if (!isNaN(total)) {
                    averageField.value = (total / 4).toFixed(2);
                } else {
                    averageField.value = '';
                }
            }
            updateMasRankings();
        });
    });

    function updateMasRankings() {
        const functions = ['sensory', 'escape', 'attention', 'tangible'];
        let scoresData = functions.map(func => {
            const totalVal = getVal(`mas_${func}_total`);
            return {
                name: func,
                total: (totalVal !== '' && !isNaN(parseFloat(totalVal))) ? parseFloat(totalVal) : -Infinity,
                rankInputId: `mas_${func}_ranking`
            };
        });

        let rankedScores = scoresData.filter(s => s.total !== -Infinity);
        rankedScores.sort((a, b) => b.total - a.total);

        let currentRank = 0;
        let lastScore = null;
        for (let i = 0; i < rankedScores.length; i++) {
            if (lastScore === null || rankedScores[i].total < lastScore) {
                currentRank++;
            }
            document.getElementById(rankedScores[i].rankInputId).value = currentRank;
            lastScore = rankedScores[i].total;
        }

        scoresData.forEach(s => {
            if (s.total === -Infinity) {
                document.getElementById(s.rankInputId).value = '';
            }
        });
    }


    function getVal(id) {
        const el = document.getElementById(id);
        return el ? el.value : '';
    }

    function isChecked(id) {
        const el = document.getElementById(id);
        return el ? el.checked : false;
    }

    function getCheckedValues(name) {
        const checkboxes = document.querySelectorAll(`input[name="${name}"]:checked`);
        return Array.from(checkboxes).map(cb => cb.value);
    }

    function getRadioValue(name) {
        const radio = document.querySelector(`input[name="${name}"]:checked`);
        return radio ? radio.value : '';
    }

    function copyReport() {
        const reportTextArea = document.getElementById('reportTextArea');
        reportTextArea.select();
        reportTextArea.setSelectionRange(0, 99999);
        try {
            document.execCommand('copy');
            const copyMessage = document.getElementById('copyMessage');
            copyMessage.textContent = 'Text Copied!';
            copyMessage.style.display = 'inline';
            setTimeout(() => {
                copyMessage.style.display = 'none';
            }, 2000);
        } catch (err) {
            console.error('Failed to copy text: ', err);
            alert('Failed to copy text. Please copy manually.');
        }
        window.getSelection().removeAllRanges();
    }


    function generateReport() {
        let report = "Documentation:\n\n";
        const assessmentDate = getVal('assessmentDate');

        // --- HELPER FUNCTIONS ---
        const formatCheckboxList = (items) => items.join(' / ');
        const formatLine = (label, value) => value && value.toString().trim() !== '' ? `${label}: ${value}\n` : '';
        const formatMultiLine = (label, value) => value && value.trim() !== '' ? `${label}:\n${value}\n` : '';

        // 1. Mental State & Insight
        let mseReport = "";
        let moodItems = getCheckedValues('mood');
        let moodOthers = getVal('mood_others');
        if (moodOthers) moodItems.push(`Others - ${moodOthers}`);
        mseReport += formatLine("Mood", formatCheckboxList(moodItems));

        mseReport += formatLine("Affect", formatCheckboxList(getCheckedValues('affect')));
        mseReport += formatLine("Speech", formatCheckboxList(getCheckedValues('expressive_speech')));

        let receptiveSteps = getVal('receptive_steps');
        let receptiveCommandType = getVal('receptive_command_type');
        let receptiveOptions = getCheckedValues('receptive_speech_options');
        let receptiveSpeechReport = "";
        if (receptiveSteps) {
            receptiveSpeechReport += `Follow ${receptiveSteps} step ${receptiveCommandType || 'verbal'} command. `;
        }
        if (receptiveOptions.length > 0) {
            receptiveSpeechReport += receptiveOptions.join(', ') + ".";
        }
        mseReport += formatLine("Receptive Speech", receptiveSpeechReport.trim());

        if (isChecked('hallucination_nil')) {
            mseReport += "Hallucination: Nil\n";
        } else {
            let hallucinationItems = getCheckedValues('hallucination').filter(v => v !== 'Nil');
            if(hallucinationItems.length > 0) mseReport += formatLine("Hallucination", formatCheckboxList(hallucinationItems));
        }

        if (isChecked('abnormal_thought_nil')) {
            mseReport += "Abnormal Thought: Nil\n";
        } else {
            let abnormalThoughtItems = getCheckedValues('abnormal_thought').filter(v => v !== 'Nil');
            let abnormalThoughtOthers = getVal('abnormal_thought_others');
            if (abnormalThoughtOthers) abnormalThoughtItems.push(`Other - ${abnormalThoughtOthers}`);
            if (abnormalThoughtItems.length > 0) mseReport += formatLine("Abnormal Thought", formatCheckboxList(abnormalThoughtItems));
        }

        let behaviourItems = getCheckedValues('behaviour');
        let behaviourOthers = getVal('behaviour_others');
        if (behaviourOthers) behaviourItems.push(`Others - ${behaviourOthers}`);
        mseReport += formatLine("Behaviour", formatCheckboxList(behaviourItems));

        mseReport += formatLine("Cognitive", formatCheckboxList(getCheckedValues('cognitive')));

        if (isChecked('risk_nil')) {
            mseReport += "Risk: Nil\n";
        } else {
            let riskItems = getCheckedValues('risk').filter(v => v !== 'Nil');
            if (riskItems.length > 0) mseReport += formatLine("Risk", formatCheckboxList(riskItems));
        }

        mseReport += formatLine("Insight", formatCheckboxList(getCheckedValues('insight')));
        mseReport += formatMultiLine("Remarks", getVal('mse_others_remarks'));

        if(mseReport.trim() !== "") {
            report += "Mental State & Insight\n";
            report += "-----------------------\n";
            report += mseReport + "\n";
        }


        // 2. Physical Assessment
        let paReport = "";
        let mmtVals = [getVal('rul_mmt'), getVal('lul_mmt'), getVal('rll_mmt'), getVal('lll_mmt')];
        if (mmtVals.some(v => v && v.trim() !== '')) {
            let powerStr = `RUL: ${getVal('rul_mmt') || 'N/A'} / LUL: ${getVal('lul_mmt') || 'N/A'} / RLL: ${getVal('rll_mmt') || 'N/A'} / LLL: ${getVal('lll_mmt') || 'N/A'}`;
            paReport += formatLine("P/E: Power", powerStr);
        }

        let aromReportText = "";
        let aromDataFound = false;
        const limbs = ['rul', 'lul', 'rll', 'lll'];
        limbs.forEach(limb => {
            const aromVal = getVal(`${limb}_arom`);
            const functional = isChecked(`${limb}_arom_functional`);
            let aromText = "";
            if (functional) {
                aromText = "Functional";
            } else if (aromVal && aromVal.trim() !== '') {
                aromText = aromVal;
            }
            if (aromText) {
                aromDataFound = true;
                aromReportText += `  ${limb.toUpperCase()}: ${aromText}\n`;
            }
        });
        if (aromDataFound) {
             paReport += "AROM:\n" + aromReportText;
        }

        let fineMotorReportText = "";
        let fmDataFound = false;
        const fmCats = ['grasp', 'opposition', 'pinch_grip', 'hand_writing'];
        ['rul', 'lul'].forEach(limb => {
            let fmItems = [];
            fmCats.forEach(cat => {
                if (isChecked(`${limb}_${cat}`)) {
                    fmDataFound = true;
                    fmItems.push(`${cat.replace('_', ' ')} (âˆš)`);
                }
            });
            if(fmItems.length > 0) {
               fineMotorReportText += `  ${limb.toUpperCase()}: ` + fmItems.join(', ') + '\n';
            }
        });
        if (fmDataFound) {
            paReport += "Fine motor:\n" + fineMotorReportText;
        }

        let contractureReportText = "";
        let anyContracture = false;
        limbs.forEach(limb => {
            if (getRadioValue(`${limb}_contracture`) === 'Y') {
                contractureReportText += `  ${limb.toUpperCase()}: Yes\n`;
                anyContracture = true;
            }
        });
        if(anyContracture) {
             const contractureDetails = getVal('pa_contracture_details');
             if(contractureDetails) contractureReportText += `  Details: ${contractureDetails}\n`;
             paReport += "Contracture / Deformity noted:\n" + contractureReportText;
        }

        const woundStatus = getRadioValue('wound_present');
        if (woundStatus === 'Y') {
            let woundTypes = getCheckedValues('wound_type').join(', ');
            if (getVal('wound_type_others')) woundTypes += (woundTypes ? ', ' : '') + `Others: ${getVal('wound_type_others')}`;
            let woundDressing = getRadioValue('wound_dressing') === 'Yes' ? 'on dressing' : 'no dressing';
            paReport += `Wound: ${woundTypes || 'Type not specified'} at ${getVal('wound_location') || 'location not specified'}, ${woundDressing}.\n`;
        } else if (woundStatus === 'N') {
            paReport += "Wound: No\n";
        }
        paReport += formatMultiLine("Other observation", getVal('general_other_observation'));
        
        if(paReport.trim() !== "") {
            report += "Physical Assessment\n";
            report += "--------------------\n";
            report += paReport + "\n";
        }

        // 3. Sensory Assessment
        let sensoryReport = "";
        let sensoryDesc = [];
        const senses = ['auditory', 'visual', 'oral', 'tactile', 'proprioception', 'vestibular'];
        senses.forEach(sense => {
            if (getCheckedValues(`${sense}_hyper`).length > 0) sensoryDesc.push(`hypersensitivity in ${sense} sense`);
            if (getCheckedValues(`${sense}_hypo`).length > 0) sensoryDesc.push(`hyposensitivity in ${sense} sense`);
            if (getCheckedValues(`${sense}_seeking`).length > 0) sensoryDesc.push(`sensory seeking in ${sense} sense`);
        });
        const examples = getVal('sensory_assessment_others');
        if (sensoryDesc.length > 0) {
            sensoryReport += `Patient showed ${sensoryDesc.join(' / ')}.`;
            if (examples) sensoryReport += ` With example of: ${examples}`;
            sensoryReport += "\n";
        } else if (examples) {
            sensoryReport += `Observations: ${examples}\n`;
        }

        const informant = getVal('sensory_profile_informant');
        let spReportContent = "";
        const spCats = [
            { key: 'low_reg', name: 'low registration' },
            { key: 'sensation_seeking', name: 'sensory seeking' },
            { key: 'sensory_sensitive', name: 'sensory sensitive' },
            { key: 'sensory_avoidance', name: 'sensory avoidance' }
        ];
        spCats.forEach(cat => {
            const score = getVal(`sp_${cat.key}_score`);
            const interpretation = getCheckedValues(`sp_${cat.key}_interpretation`).join(', ');
            if (score || interpretation) {
                spReportContent += `  - ${cat.name}: Score ${score || 'N/A'}/75. Interpretation: ${interpretation || 'N/A'}\n`;
            }
        });

        if (spReportContent) {
            sensoryReport += `Sensory profile done on: ${assessmentDate || '(date not specified)'}, with ${informant || '(informant not specified)'} as informant. Results showed that patient showed:\n`;
            sensoryReport += spReportContent;
        }

        if(sensoryReport.trim() !== "") {
            report += "Sensory Assessment\n";
            report += "-------------------\n";
            report += sensoryReport + "\n";
        }


        // 4. Behavioural Assessment
        let behaviourReport = "";
        behaviourReport += formatLine("MAS Target Behaviour", getVal('mas_target_behaviour_overall'));
        let masReportText = "";
        const masFunctions = ['sensory', 'escape', 'attention', 'tangible'];
        let masDataFound = false;
        masFunctions.forEach(func => {
            const total = getVal(`mas_${func}_total`);
            const average = getVal(`mas_${func}_average`);
            const ranking = getVal(`mas_${func}_ranking`);
            if (total || average || ranking) {
                masDataFound = true;
                masReportText += `  - ${func.charAt(0).toUpperCase() + func.slice(1)}:\n    Total Score: ${total || 'N/A'}\n    Average Score: ${average || 'N/A'}\n    Relative Ranking: ${ranking || 'N/A'}\n`;
            }
        });
        if (masDataFound) {
            behaviourReport += "Motivational Assessment Scale results:\n" + masReportText;
        }

        behaviourReport += formatLine("CBI Target Behaviour (Patient's major challenging behaviour)", getVal('cbi_target_behaviour'));
        const cbiScore = getVal('cbi_total_score');
        if (cbiScore) behaviourReport += formatLine("Challenging Behaviour Interview Score", `${cbiScore}/55`);

        if(behaviourReport.trim() !== "") {
            report += "Behavioural Assessment\n";
            report += "-----------------------\n";
            report += behaviourReport + "\n";
        }

        // 5. Environmental Assessment
        let envReport = "";
        let livesWith = getCheckedValues('lives_with');
        if (getVal('lives_with_others')) livesWith.push(getVal('lives_with_others'));
        if(livesWith.length > 0) envReport += `Patient was living with ${livesWith.join('/')}.\n`;

        let homeVisitReport = "";
        let envLightingItems = getCheckedValues('env_lighting');
        let envNoiseItems = getCheckedValues('env_noise');
        if (isChecked('env_noise_not_available')) envNoiseItems.push("Quiet zone/ Pad room was not available");

        if (envLightingItems.length > 0 || envNoiseItems.length > 0) {
            let envLighting = formatCheckboxList(envLightingItems) || 'not specified';
            let envNoise = formatCheckboxList(envNoiseItems) || 'not specified';
            homeVisitReport += `  The hostel/ home was ${envLighting}. Noise level was ${envNoise}.\n`;
        }

        let safetyHazards = getCheckedValues('env_safety_hazard');
        let safetyHazardDesc = getVal('env_safety_hazard_others');
        if(isChecked('env_safety_hazard_not_presented')) {
             homeVisitReport += "  Safety hazard was not presented.\n";
        } else if (safetyHazards.length > 0 || safetyHazardDesc) {
            homeVisitReport += `  Safety hazard: ${safetyHazards.join(', ')}`;
            if(safetyHazardDesc) homeVisitReport += ` (${safetyHazardDesc}).\n`;
            else homeVisitReport += '.\n';
        }
        
        if (homeVisitReport.trim() !== "") {
            envReport += "\nHome Visit / Hostel Environment:\n" + homeVisitReport;
        }

        envReport += formatMultiLine("\nOthers (e.g. Layout - Overall Environmental Assessment)", getVal('env_others_layout'));

        if(envReport.trim() !== "") {
            report += "Environmental Assessment\n";
            report += "-------------------------\n";
            report += envReport + "\n";
        }
        
        // Occupation
        let occupationReport = "";
        occupationReport += getVal('occupation_details');
        if (occupationReport.trim() !== "") {
            report += "Occupation\n";
            report += "----------\n";
            report += occupationReport + "\n\n";
        }


        // 6. Independent Function Assessment
        let funcReport = "";
        let badlReportStr = "";
        const badlActivities = ['feeding', 'grooming', 'dressing', 'toileting', 'bathing'];
        let badlLevelsSpecified = false;
        badlActivities.forEach(activity => {
            const level = getVal(`badl_${activity}_level`);
            if (level) {
                badlLevelsSpecified = true;
                badlReportStr += `  - ${activity.charAt(0).toUpperCase() + activity.slice(1)}: ${level}\n`;
            }
        });
        if (badlLevelsSpecified) {
            funcReport += "BADL Qualitative Levels:\n" + badlReportStr;
        }
        const mbiTotal = getVal('mbi_total_score_display');
        if (mbiTotal) funcReport += formatLine("MBI Score", `${mbiTotal}/100`);
        funcReport += formatMultiLine("MBI Remarks", getVal('mbi_remarks'));

        let sibrIndepAgeY = getVal('sibr_indep_age_year');
        let sibrIndepAgeM = getVal('sibr_indep_age_month');
        let sibrSupportScore = getVal('sibr_support_score');
        let sibrSupportLevel = getRadioValue('sibr_support_level');
        if(sibrIndepAgeY || sibrIndepAgeM || sibrSupportScore || sibrSupportLevel){
            let sibrIndepAge = `Year: ${sibrIndepAgeY || 'N/A'}, Month: ${sibrIndepAgeM || 'N/A'}`;
            funcReport += `IADL: SIB-R: Broad independence age equivalence: ${sibrIndepAge}, Support score: ${sibrSupportScore || 'N/A'}/100, Support level: ${sibrSupportLevel || 'N/A'}.\n`;
        }
        funcReport += formatMultiLine("SIB-R Remarks", getVal('sibr_remarks'));

        if(funcReport.trim() !== "") {
            report += "Functional Assessment\n";
            report += "----------------------\n";
            report += funcReport + "\n";
        }

        // 7. Work Assessment
        let workReport = "";
        let premorbidParts = [];
        getCheckedValues('premorbid_status').forEach(val => {
            if (val === "OE" && isChecked('premorbid_oe_job_status_cb')) {
                const oeDetails = getVal('premorbid_oe_job_details');
                premorbidParts.push(oeDetails ? `OE (${oeDetails})` : 'OE');
            } else if (val !== "OE") {
                premorbidParts.push(val);
            }
        });
        let premorbidStr = premorbidParts.join(' / ');
        const mainWorkTask = getVal('premorbid_main_work_task');
        if (mainWorkTask) {
            premorbidStr += (premorbidStr ? ", " : "") + `Main work task: ${mainWorkTask}`;
        }
        workReport += formatLine("Premorbid", premorbidStr);

        let bwaReport = "";
        const bwapDomainKeys = ['wha', 'ir', 'cs', 'wps', 'bwa'];
        const bwapDomainNames = {'wha': 'Work Habits/ Attitudes', 'ir': 'Interpersonal Relations', 'cs': 'Cognitive Skills', 'wps': 'Work Performance Skills', 'bwa': 'Broad Work Adjustment'};
        bwapDomainKeys.forEach(key => {
            const percentile = getVal(`bwap_${key}_percentile`);
            const placements = getCheckedValues(`bwap_${key}_placement`);
            if (percentile || placements.length > 0) {
                bwaReport += `  ${bwapDomainNames[key]} percentile: ${percentile || 'N/A'}. `;
                if (placements.length > 0) {
                    bwaReport += `Working Placement: ${placements.join(', ')}.\n`;
                } else {
                    bwaReport += "\n";
                }
            }
        });
        if(bwaReport) {
            workReport += "BWAP-2:\n" + bwaReport;
        }
        workReport += formatMultiLine("BWAP-2 Remarks", getVal('bwap_remarks'));

        if(workReport.trim() !== "") {
            report += "Work Assessment\n";
            report += "----------------\n";
            report += workReport + "\n";
        }


        // OT Plan
        let otPlanReport = "";
        let otPlanItems = [];
        document.querySelectorAll('input[name="otp_item"]:checked').forEach(cb => {
            let itemText = cb.value;
            if (cb.id === "otp_home_visit") {
                itemText = `Home / Hostel visit ${assessmentDate ? 'on ' + assessmentDate : '(date TBD)'}`;
            }
            otPlanItems.push(`- ${itemText}`);
        });
        const customOtPlan = getVal('ot_plan_custom');
        if (customOtPlan) {
            customOtPlan.split('\n').forEach(item => {
                if (item.trim()) otPlanItems.push(`- ${item.trim()}`);
            });
        }
        if (otPlanItems.length > 0) {
            otPlanReport += otPlanItems.join('\n') + '\n';
        }

        if (otPlanReport.trim() !== "") {
            report += "OT Plan:\n";
            report += "--------\n";
            report += otPlanReport + "\n";
        }

        document.getElementById('reportTextArea').value = report;
    }
    updateMasRankings();
</script>

</body>
</html>
